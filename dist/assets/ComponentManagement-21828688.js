import{a as e,B as s,j as a,n as l,l as t,u as i,P as n}from"./ui-1c32109a.js";import{r}from"./vendor-4f48b5c9.js";import{C as c,b as d,c as o,d as m,B as h,a as x,L as j,I as p,T as u,e as v,f as g,g as N}from"./index-6a75618c.js";import{T as y,D as f,a as b,b as w,c as C,d as M}from"./textarea-cf89bf64.js";import{S,a as D,b as k,c as I,d as T}from"./select-955880ab.js";import{i as F,g as $,f as q,a as A,b as P,c as V}from"./helpers-6267cebc.js";import{C as E,T as B,a as O}from"./constants-92d367f8.js";import{p as z,a as W}from"./info-3e790e87.js";function R({component:n,vehicle:r,onEdit:j}){const p="tire"===n.componentType?e:s,u=(()=>{if(!n.warrantyMonths)return null;const e=new Date(n.installationDate),s=new Date(e);return s.setMonth(s.getMonth()+n.warrantyMonths),s})(),v=u&&new Date<=u,g=u&&F(u.toISOString(),30);return a.jsxs(c,{className:"hover:shadow-md transition-shadow",children:[a.jsx(d,{className:"pb-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:a.jsx(p,{className:"h-5 w-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsxs(o,{className:"text-lg",children:[n.make," ",n.model]}),a.jsx("p",{className:"text-sm text-gray-600",children:r?`${r.gkNumber} - ${r.make} ${r.model}`:n.vehicleId})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(m,{className:`${$(n.status)} text-white`,children:n.status}),v&&!g&&a.jsx(m,{className:"bg-green-500 text-white",children:"Under Warranty"}),g&&a.jsx(m,{className:"bg-orange-500 text-white",children:"Warranty Expiring Soon"}),j&&a.jsx(h,{variant:"ghost",size:"sm",onClick:()=>j(n),children:a.jsx(l,{className:"h-4 w-4"})})]})]})}),a.jsxs(x,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Serial Number"}),a.jsx("p",{className:"font-medium",children:n.serialNumber})]}),n.position&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Position"}),a.jsx("p",{className:"font-medium capitalize",children:n.position.replace("-"," ")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Installation Date"}),a.jsxs("p",{className:"font-medium flex items-center gap-1",children:[a.jsx(t,{className:"h-3 w-3"}),q(n.installationDate)]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Installation Mileage"}),a.jsxs("p",{className:"font-medium",children:[A(n.installationMileage)," km"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Purchase Cost"}),a.jsxs("p",{className:"font-medium flex items-center gap-1",children:[a.jsx(i,{className:"h-3 w-3"}),P(n.purchaseCost)]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Supplier"}),a.jsx("p",{className:"font-medium",children:n.supplier})]})]}),n.removalDate&&a.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium text-gray-800 mb-1",children:"Removal Information"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-600",children:"Removal Date"}),a.jsx("p",{className:"text-sm",children:q(n.removalDate)})]}),n.removalMileage&&a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-600",children:"Removal Mileage"}),a.jsxs("p",{className:"text-sm",children:[A(n.removalMileage)," km"]})]})]})]}),u&&a.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"Warranty Information"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-blue-600",children:"Warranty Period"}),a.jsxs("p",{className:"text-sm",children:[n.warrantyMonths," months"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-blue-600",children:"Expires"}),a.jsx("p",{className:"text-sm",children:q(u.toISOString())})]})]}),g&&a.jsxs("p",{className:"text-xs text-orange-600 mt-2",children:["Expires in ",V(u.toISOString())," days"]})]}),n.notes&&a.jsxs("div",{className:"mt-4 pt-3 border-t",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Notes"}),a.jsx("p",{className:"text-sm",children:n.notes})]})]})]})}const U=`https://${W}.supabase.co/functions/v1/make-server-3fe6e872`;function J(){const[l,t]=r.useState([]),[i,d]=r.useState([]),[o,m]=r.useState(!1),[F,$]=r.useState("all"),[q,A]=r.useState({vehicleId:"",componentType:"tire",make:"",model:"",serialNumber:"",position:"",installationDate:"",installationMileage:0,removalDate:"",removalMileage:0,status:"active",warrantyMonths:0,purchaseCost:0,supplier:"",notes:""});r.useEffect(()=>{P(),V()},[]);const P=async()=>{try{const e=await fetch(`${U}/components`,{headers:{Authorization:`Bearer ${z}`,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();t(s.components||[])}}catch(e){}},V=async()=>{try{const e=await fetch(`${U}/vehicles`,{headers:{Authorization:`Bearer ${z}`,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();d(s.vehicles||[])}}catch(e){}},W=()=>{A({vehicleId:"",componentType:"tire",make:"",model:"",serialNumber:"",position:"",installationDate:"",installationMileage:0,removalDate:"",removalMileage:0,status:"active",warrantyMonths:0,purchaseCost:0,supplier:"",notes:""})},J=a.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch(`${U}/components`,{method:"POST",headers:{Authorization:`Bearer ${z}`,"Content-Type":"application/json"},body:JSON.stringify(q)})).ok&&(m(!1),W(),P())}catch(s){}},className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(j,{htmlFor:"vehicleId",children:"Vehicle*"}),a.jsxs(S,{value:q.vehicleId,onValueChange:e=>A({...q,vehicleId:e}),children:[a.jsx(D,{children:a.jsx(k,{placeholder:"Select a vehicle"})}),a.jsx(I,{children:i.map(e=>a.jsxs(T,{value:e.id,children:[e.gkNumber," - ",e.make," ",e.model]},e.id))})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(j,{htmlFor:"componentType",children:"Component Type*"}),a.jsxs(S,{value:q.componentType,onValueChange:e=>A({...q,componentType:e}),children:[a.jsx(D,{children:a.jsx(k,{})}),a.jsx(I,{children:E.map(e=>a.jsx(T,{value:e.value,children:e.label},e.value))})]})]}),"tire"===q.componentType&&a.jsxs("div",{children:[a.jsx(j,{htmlFor:"position",children:"Position*"}),a.jsxs(S,{value:q.position,onValueChange:e=>A({...q,position:e}),children:[a.jsx(D,{children:a.jsx(k,{placeholder:"Select position"})}),a.jsx(I,{children:B.map(e=>a.jsx(T,{value:e.value,children:e.label},e.value))})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(j,{htmlFor:"make",children:"Make*"}),a.jsx(p,{id:"make",value:q.make,onChange:e=>A({...q,make:e.target.value}),placeholder:"Michelin, Exide, etc.",required:!0})]}),a.jsxs("div",{children:[a.jsx(j,{htmlFor:"model",children:"Model*"}),a.jsx(p,{id:"model",value:q.model,onChange:e=>A({...q,model:e.target.value}),placeholder:"Model/Part number",required:!0})]})]}),a.jsxs("div",{children:[a.jsx(j,{htmlFor:"serialNumber",children:"Serial Number*"}),a.jsx(p,{id:"serialNumber",value:q.serialNumber,onChange:e=>A({...q,serialNumber:e.target.value}),placeholder:"Unique identifier",required:!0})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(j,{htmlFor:"installationDate",children:"Installation Date*"}),a.jsx(p,{id:"installationDate",type:"date",value:q.installationDate,onChange:e=>A({...q,installationDate:e.target.value}),required:!0})]}),a.jsxs("div",{children:[a.jsx(j,{htmlFor:"installationMileage",children:"Installation Mileage (km)*"}),a.jsx(p,{id:"installationMileage",type:"number",value:q.installationMileage,onChange:e=>A({...q,installationMileage:parseInt(e.target.value)||0}),placeholder:"45000",required:!0})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(j,{htmlFor:"status",children:"Status*"}),a.jsxs(S,{value:q.status,onValueChange:e=>A({...q,status:e}),children:[a.jsx(D,{children:a.jsx(k,{})}),a.jsx(I,{children:O.map(e=>a.jsx(T,{value:e.value,children:e.label},e.value))})]})]}),a.jsxs("div",{children:[a.jsx(j,{htmlFor:"warrantyMonths",children:"Warranty (months)"}),a.jsx(p,{id:"warrantyMonths",type:"number",value:q.warrantyMonths,onChange:e=>A({...q,warrantyMonths:parseInt(e.target.value)||0}),placeholder:"12"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(j,{htmlFor:"purchaseCost",children:"Purchase Cost (KES)*"}),a.jsx(p,{id:"purchaseCost",type:"number",step:"0.01",value:q.purchaseCost,onChange:e=>A({...q,purchaseCost:parseFloat(e.target.value)||0}),placeholder:"25000.00",required:!0})]}),a.jsxs("div",{children:[a.jsx(j,{htmlFor:"supplier",children:"Supplier*"}),a.jsx(p,{id:"supplier",value:q.supplier,onChange:e=>A({...q,supplier:e.target.value}),placeholder:"Supplier name",required:!0})]})]}),a.jsxs("div",{children:[a.jsx(j,{htmlFor:"notes",children:"Notes"}),a.jsx(y,{id:"notes",value:q.notes,onChange:e=>A({...q,notes:e.target.value}),placeholder:"Additional information..."})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx(h,{type:"button",variant:"outline",onClick:()=>{m(!1),W()},children:"Cancel"}),a.jsx(h,{type:"submit",children:"Add Component"})]})]}),K=t=>{const n=(e=>{let s=l.filter(s=>s.componentType===e);return"all"!==F&&(s=s.filter(e=>e.vehicleId===F)),s.sort((e,s)=>new Date(s.installationDate).getTime()-new Date(e.installationDate).getTime())})(t),r="tire"===t?e:s;return a.jsx("div",{className:"space-y-4",children:0===n.length?a.jsx(c,{children:a.jsxs(x,{className:"py-8 text-center",children:[a.jsx(r,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),a.jsxs("p",{className:"text-gray-600",children:["No ",t," records found."]})]})}):n.map(e=>{return a.jsx(R,{component:e,vehicle:(s=e.vehicleId,i.find(e=>e.id===s))},e.id);var s})})};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Component Management"}),a.jsxs(f,{open:o,onOpenChange:m,children:[a.jsx(b,{asChild:!0,children:a.jsxs(h,{className:"flex items-center gap-2",children:[a.jsx(n,{className:"h-4 w-4"}),"Add Component"]})}),a.jsxs(w,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[a.jsx(C,{children:a.jsx(M,{children:"Add New Component"})}),J]})]})]}),a.jsx("div",{className:"mb-6",children:a.jsxs(S,{value:F,onValueChange:$,children:[a.jsx(D,{className:"w-64",children:a.jsx(k,{})}),a.jsxs(I,{children:[a.jsx(T,{value:"all",children:"All Vehicles"}),i.map(e=>a.jsxs(T,{value:e.id,children:[e.gkNumber," - ",e.make," ",e.model]},e.id))]})]})}),a.jsxs(u,{defaultValue:"tires",className:"w-full",children:[a.jsxs(v,{className:"grid w-full grid-cols-2",children:[a.jsxs(g,{value:"tires",className:"flex items-center gap-2",children:[a.jsx(e,{className:"h-4 w-4"}),"Tires"]}),a.jsxs(g,{value:"batteries",className:"flex items-center gap-2",children:[a.jsx(s,{className:"h-4 w-4"}),"Batteries"]})]}),a.jsx(N,{value:"tires",className:"mt-6",children:K("tire")}),a.jsx(N,{value:"batteries",className:"mt-6",children:K("battery")})]})]})}export{J as ComponentManagement};
