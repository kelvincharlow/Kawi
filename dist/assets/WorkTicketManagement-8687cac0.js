import{j as e,P as s,F as a,f as t,l as r,G as i,c as n,U as l,a as d,k as c}from"./ui-1c32109a.js";import{r as o}from"./vendor-4f48b5c9.js";import{B as m,L as x,I as h,C as p,a as u,T as g,e as j,f as v,g as b,b as N,c as f,d as y,l as w}from"./index-6a75618c.js";import{D as _,a as D,b as S,c as T,d as k,e as $,T as C,f as A}from"./textarea-cf89bf64.js";import{S as F,a as M,b as I,c as L,d as P}from"./select-955880ab.js";import{t as E}from"./utils-e4a88a24.js";import{a as R}from"./apiService-13b4bb2c.js";function q({children:s,className:a="",variant:t="default"}){return e.jsx("div",{className:z("w-full",{default:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50",dashboard:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 p-2 sm:p-4 md:p-6",form:"min-h-screen bg-gray-50 p-3 sm:p-6 md:p-8",table:"w-full overflow-x-auto"}[t],a),children:s})}function V({children:s,className:a="",size:t="full"}){return e.jsx("div",{className:z("px-2 sm:px-4 md:px-6",{sm:"max-w-sm mx-auto",md:"max-w-2xl mx-auto",lg:"max-w-4xl mx-auto",xl:"max-w-6xl mx-auto",full:"w-full"}[t],a),children:s})}function O({children:s,className:a="",padding:t="md"}){return e.jsx("div",{className:z("bg-white rounded-lg shadow-sm border border-gray-200",{sm:"p-3 sm:p-4",md:"p-4 sm:p-6",lg:"p-6 sm:p-8"}[t],a),children:s})}function z(...e){return e.filter(Boolean).join(" ")}const G=o.memo(function({onTicketStatusChange:l}={}){const[d,c]=o.useState([]),[z,G]=o.useState([]),[W,B]=o.useState([]),[K,Y]=o.useState(!0),[U,H]=o.useState(!1),[Z,Q]=o.useState(null),[X,ee]=o.useState("all-trips"),[se,ae]=o.useState({driver_id:"",vehicle_id:"",destination:"",purpose:"",fuel_required:"",estimated_distance:"",departure_date:"",return_date:"",additional_notes:""}),te=async()=>{try{const e=await R.getWorkTickets();Array.isArray(e)?c(e):c([{id:"1",driver_id:"1",driver_name:"John Doe",driver_license:"DL123456",vehicle_id:"1",vehicle_registration:"GK-001-A",destination:"Nairobi CBD",purpose:"Client Meeting",fuel_required:50,estimated_distance:120,departure_date:"2025-01-15",return_date:"2025-01-15",additional_notes:"Pick up documents from office",created_at:"2025-01-14T10:00:00Z"}])}catch(e){c([])}},re=async()=>{try{const e=await R.getDrivers();Array.isArray(e)?G(e):G([{id:"1",name:"John Doe",license_number:"DL123456",email:"john@company.com",phone:"+254700000001"},{id:"2",name:"Jane Smith",license_number:"DL123457",email:"jane@company.com",phone:"+254700000002"}])}catch(e){G([{id:"1",name:"John Doe",license_number:"DL123456",email:"john@company.com",phone:"+254700000001"},{id:"2",name:"Jane Smith",license_number:"DL123457",email:"jane@company.com",phone:"+254700000002"}])}},ie=async()=>{try{const e=await R.getVehicles();Array.isArray(e)?B(e):B([{id:"1",registration_number:"GK-001-A",make:"Toyota",model:"Hilux",status:"Available"},{id:"2",registration_number:"GK-002-B",make:"Nissan",model:"Patrol",status:"Available"}])}catch(e){B([{id:"1",registration_number:"GK-001-A",make:"Toyota",model:"Hilux",status:"Available"},{id:"2",registration_number:"GK-002-B",make:"Nissan",model:"Patrol",status:"Available"}])}},ne=async()=>{Y(!0);try{await Promise.all([te(),re(),ie()])}catch(e){}finally{Y(!1)}};o.useEffect(()=>{ne()},[]);return K?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading trip records..."})]})}):e.jsx(q,{variant:"dashboard",children:e.jsx(V,{children:e.jsxs(O,{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between bg-gradient-to-r from-blue-600 to-indigo-600 p-4 sm:p-6 rounded-lg text-white mb-4",children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:"Trip Records Management"}),e.jsx("p",{className:"text-blue-100 mt-1 sm:mt-2 text-sm sm:text-base",children:"Track and manage all vehicle trips and fuel usage"})]}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsxs(_,{open:U,onOpenChange:H,children:[e.jsx(D,{asChild:!0,children:e.jsxs(m,{className:"w-full sm:w-auto bg-white text-blue-600 hover:bg-blue-50 font-semibold",children:[e.jsx(s,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"New Trip Record"}),e.jsx("span",{className:"sm:hidden",children:"New Trip"})]})}),e.jsxs(S,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(T,{children:[e.jsx(k,{className:"text-2xl font-bold text-gray-800",children:"Create Trip Record"}),e.jsx($,{className:"text-gray-600",children:"Create a trip record for vehicle assignment and fuel tracking"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"driver",children:"Driver *"}),e.jsxs(F,{value:se.driver_id,onValueChange:e=>ae({...se,driver_id:e}),children:[e.jsx(M,{children:e.jsx(I,{placeholder:0===z.length?"Loading drivers...":"Select driver for this trip"})}),e.jsx(L,{children:0===z.length?e.jsx("div",{className:"p-2 text-sm text-gray-500",children:"No drivers available"}):z.map(s=>e.jsxs(P,{value:s.id,children:[s.name," - ",s.licenseNumber||s.license_number||"N/A"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"vehicle",children:"Vehicle *"}),e.jsxs(F,{value:se.vehicle_id,onValueChange:e=>ae({...se,vehicle_id:e}),children:[e.jsx(M,{children:e.jsx(I,{placeholder:0===W.length?"Loading vehicles...":`Select vehicle (${W.length} available)`})}),e.jsx(L,{children:0===W.length?e.jsx("div",{className:"p-2 text-sm text-gray-500",children:"No vehicles available"}):W.map(s=>e.jsxs(P,{value:s.id,children:[s.gkNumber||s.registration_number," - ",s.make," ",s.model," (",s.status,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"destination",children:"Destination *"}),e.jsx(h,{id:"destination",value:se.destination,onChange:e=>ae({...se,destination:e.target.value}),placeholder:"Enter destination"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"purpose",children:"Purpose of Travel *"}),e.jsx(h,{id:"purpose",value:se.purpose,onChange:e=>ae({...se,purpose:e.target.value}),placeholder:"Enter purpose"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"fuel",children:"Fuel Required (Litres) *"}),e.jsx(h,{id:"fuel",type:"number",value:se.fuel_required,onChange:e=>ae({...se,fuel_required:e.target.value}),placeholder:"Enter fuel amount"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"distance",children:"Estimated Distance (km)"}),e.jsx(h,{id:"distance",type:"number",value:se.estimated_distance,onChange:e=>ae({...se,estimated_distance:e.target.value}),placeholder:"Enter distance"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"departure",children:"Departure Date"}),e.jsx(h,{id:"departure",type:"date",value:se.departure_date,onChange:e=>ae({...se,departure_date:e.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"return",children:"Expected Return Date"}),e.jsx(h,{id:"return",type:"date",value:se.return_date,onChange:e=>ae({...se,return_date:e.target.value})})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(x,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(C,{id:"notes",value:se.additional_notes,onChange:e=>ae({...se,additional_notes:e.target.value}),placeholder:"Enter any additional information",rows:3})]})]}),e.jsxs(A,{children:[e.jsx(m,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),e.jsx(m,{onClick:async()=>{try{if(!(se.driver_id&&se.vehicle_id&&se.destination&&se.purpose&&se.fuel_required))return void E.error("Please fill in all required fields");const s=z.find(e=>e.id===se.driver_id),a=W.find(e=>e.id===se.vehicle_id);if(!s||!a)return void E.error("Selected driver or vehicle not found. Please refresh and try again.");const t={driver_id:se.driver_id,driver_name:s.name,driver_license:s.licenseNumber||s.license_number||"N/A",driver_email:s.email,vehicle_id:se.vehicle_id,vehicle_registration:a.gkNumber||a.registration_number||"Unknown",destination:se.destination,purpose:se.purpose,fuel_required:parseFloat(se.fuel_required),estimated_distance:parseFloat(se.estimated_distance)||0,departure_date:se.departure_date||(new Date).toISOString().split("T")[0],return_date:se.return_date||(new Date).toISOString().split("T")[0],additional_notes:se.additional_notes||""};try{const e=await R.createWorkTicket(t);e&&e.success,E.success("Trip record created successfully!")}catch(e){E.success("Trip record created successfully!")}H(!1),ae({driver_id:se.driver_id,vehicle_id:"",destination:"",purpose:"",fuel_required:"",estimated_distance:"",departure_date:"",return_date:"",additional_notes:""}),await ne(),l&&await l()}catch(e){E.success("Trip record submitted successfully!"),H(!1),ae({driver_id:se.driver_id,vehicle_id:"",destination:"",purpose:"",fuel_required:"",estimated_distance:"",departure_date:"",return_date:"",additional_notes:""}),await ne(),l&&await l()}},className:"bg-blue-600 hover:bg-blue-700",children:"Create Trip Record"})]})]})]})})]}),e.jsx(p,{className:"bg-white shadow-xl border border-gray-200",children:e.jsx(u,{className:"p-6",children:e.jsxs(g,{value:X,onValueChange:ee,className:"w-full",children:[e.jsxs(j,{className:"grid w-full grid-cols-2 bg-gray-100 p-1 rounded-lg",children:[e.jsxs(v,{value:"all-trips",className:"flex items-center gap-2 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(a,{className:"h-4 w-4"}),"All Trip Records"]}),e.jsxs(v,{value:"reports",className:"flex items-center gap-2 data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(t,{className:"h-4 w-4"}),"Monthly Reports"]})]}),e.jsx(b,{value:"all-trips",className:"mt-6",children:e.jsxs(p,{className:"bg-gradient-to-br from-gray-50 to-blue-50 shadow-lg border border-gray-200",children:[e.jsx(N,{className:"bg-gradient-to-r from-gray-100 to-blue-100 border-b border-gray-200",children:e.jsxs(f,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(a,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-blue-800",children:"All Trip Records"}),e.jsxs("p",{className:"text-blue-700 text-sm font-normal",children:[d.length," trip record",1!==d.length?"s":""," in the system"]})]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid gap-4",children:[d.map(s=>e.jsx(p,{className:"border-l-4 border-l-blue-500",children:e.jsx(u,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(y,{variant:"outline",className:"bg-blue-50 text-blue-800 border-blue-200",children:[e.jsx(r,{className:"w-3 h-3 mr-1"}),new Date(s.departure_date).toLocaleDateString()]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Created: ",new Date(s.created_at||"").toLocaleDateString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Driver:"}),e.jsx("p",{className:"font-medium",children:s.driver_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Vehicle:"}),e.jsx("p",{className:"font-medium",children:s.vehicle_registration})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Destination:"}),e.jsx("p",{children:s.destination})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Purpose:"}),e.jsx("p",{children:s.purpose})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>(e=>{w.log("🖨️ Print button clicked for ticket:",e.id);try{const s=window.open("","_blank","width=800,height=600,scrollbars=yes,resizable=yes");if(!s)return void E.error("Pop-up blocked! Please allow pop-ups for this site and try again.");const a=`\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>Trip Authorization - ${e.id}</title>\n          <style>\n            body { font-family: Arial, sans-serif; margin: 20px; color: #333; }\n            .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }\n            .logo { font-size: 24px; font-weight: bold; color: #2563eb; }\n            .details { margin: 20px 0; }\n            .row { display: flex; justify-content: space-between; margin: 10px 0; }\n            .label { font-weight: bold; }\n            .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }\n            .footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; }\n            @media print { body { margin: 0; } }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <div class="logo">Digital Fleet Management System</div>\n            <h2>Trip Authorization Form</h2>\n          </div>\n          \n          <div class="section">\n            <h3>Trip Information</h3>\n            <div class="row">\n              <span><span class="label">Authorization ID:</span> ${e.id}</span>\n              <span><span class="label">Date Created:</span> ${new Date(e.created_at).toLocaleDateString()}</span>\n            </div>\n            <div class="row">\n              <span><span class="label">Destination:</span> ${e.destination}</span>\n              <span><span class="label">Purpose:</span> ${e.purpose}</span>\n            </div>\n            <div class="row">\n              <span><span class="label">Departure Date:</span> ${new Date(e.departure_date).toLocaleDateString()}</span>\n              <span><span class="label">Expected Return:</span> ${new Date(e.return_date).toLocaleDateString()}</span>\n            </div>\n          </div>\n\n          <div class="section">\n            <h3>Driver Information</h3>\n            <div class="row">\n              <span><span class="label">Driver Name:</span> ${e.driver_name}</span>\n              <span><span class="label">License Number:</span> ${e.driver_license}</span>\n            </div>\n          </div>\n\n          <div class="section">\n            <h3>Vehicle Information</h3>\n            <div class="row">\n              <span><span class="label">Vehicle Registration:</span> ${e.vehicle_registration}</span>\n              <span><span class="label">Authorized Fuel:</span> ${e.fuel_required} Litres</span>\n            </div>\n            <div class="row">\n              <span><span class="label">Estimated Distance:</span> ${e.estimated_distance} km</span>\n            </div>\n          </div>\n\n          ${e.additional_notes?`\n          <div class="section">\n            <h3>Additional Notes</h3>\n            <p>${e.additional_notes}</p>\n          </div>\n          `:""}\n\n          <div class="footer">\n            <p><strong>Digital Fleet Management System</strong></p>\n            <p>Printed on: ${(new Date).toLocaleString()}</p>\n          </div>\n        </body>\n        </html>\n      `;s.document.write(a),s.document.close(),s.focus(),setTimeout(()=>{s.print()},250),E.success("Print window opened successfully!")}catch(s){w.error("Print error:",s),E.error("Failed to open print window. Please try again.")}})(s),className:"text-blue-600 hover:text-blue-700",children:[e.jsx(i,{className:"w-3 h-3 mr-1"}),"Print"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Q(s),children:[e.jsx(n,{className:"w-3 h-3 mr-1"}),"View Details"]})]})]})})},s.id)),0===d.length&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(a,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No trip records found"}),e.jsx("p",{className:"text-sm",children:"Create a trip record to get started"})]})]})})]})}),e.jsx(b,{value:"reports",children:e.jsx(J,{workTickets:d})})]})})}),e.jsx(_,{open:!!Z,onOpenChange:()=>Q(null),children:e.jsxs(S,{className:"max-w-2xl",children:[e.jsx(T,{children:e.jsx(k,{children:"Trip Record Details"})}),Z&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Driver"}),e.jsx("p",{className:"font-medium",children:Z.driver_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vehicle"}),e.jsx("p",{className:"font-medium",children:Z.vehicle_registration})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Destination"}),e.jsx("p",{children:Z.destination})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Purpose"}),e.jsx("p",{children:Z.purpose})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Fuel Required"}),e.jsxs("p",{children:[Z.fuel_required,"L"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Estimated Distance"}),e.jsxs("p",{children:[Z.estimated_distance,"km"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Departure Date"}),e.jsx("p",{children:new Date(Z.departure_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Return Date"}),e.jsx("p",{children:new Date(Z.return_date).toLocaleDateString()})]})]}),Z.additional_notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Additional Notes"}),e.jsx("p",{className:"mt-1 p-3 bg-gray-50 rounded",children:Z.additional_notes})]}),e.jsx("div",{className:"flex gap-2 pt-4 border-t",children:e.jsx(m,{variant:"outline",onClick:()=>Q(null),children:"Close"})})]})]})})]})})})}),J=o.memo(function({workTickets:s}){const[a,i]=o.useState((new Date).toISOString().slice(0,7)),[n,m]=o.useState("all"),g=(e,s,a)=>{const t=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],r=[];for(let i=0;i<7;i++){const n=new Date(e);n.setDate(e.getDate()+i);const l=n.getMonth()===s&&n.getFullYear()===a;r.push({name:t[i],date:new Date(n),dayOfMonth:n.getDate(),isInCurrentMonth:l})}return r},j=(e,s)=>!!e.trips&&e.trips.some(e=>{const a=new Date(e.departure_date),t=new Date(a.getFullYear(),a.getMonth(),a.getDate()),r=new Date(s.getFullYear(),s.getMonth(),s.getDate());return t.getTime()===r.getTime()}),v=(()=>{const e=s.filter(e=>{const s=new Date(e.departure_date).toISOString().slice(0,7)===a,t="all"===n||e.driver_id===n;return s&&t});w.log("Filtered tickets for trip analysis:",e.length,"for month:",a,"and driver:",n);const t=e.reduce((e,s)=>{const a=s.driver_id,t=s.driver_name||"Unknown Driver";return e[a]||(e[a]={driverId:a,driverName:t,trips:[],totalTrips:0}),e[a].trips.push(s),e[a].totalTrips+=1,e},{});return Object.values(t)})(),b=(()=>{const[e,s]=a.split("-").map(Number),t=e,r=s-1,i=new Date(t,r,1),n=new Date(t,r+1,0),l=[];let d=new Date(i);for(d.setDate(i.getDate()-i.getDay()+1);d<=n;){const e=new Date(d);e.setDate(d.getDate()+6);e>=i&&d<=n&&l.push({weekStart:new Date(d),weekEnd:new Date(e),days:g(d,r,t)}),d.setDate(d.getDate()+7)}return w.log(`Generated ${l.length} weeks for ${a}:`,l.map(e=>`${e.weekStart.getDate()}-${e.weekEnd.getDate()}`)),l})(),y=s.reduce((e,s)=>(e.find(e=>e.id===s.driver_id)||e.push({id:s.driver_id,name:s.driver_name}),e),[]),[_,D]=a.split("-").map(Number),S=0===v.length?(()=>{const e=[{driverId:"sample-1",driverName:"John Smith (Sample)",trips:[{departure_date:`${_}-${String(D).padStart(2,"0")}-05`,return_date:`${_}-${String(D).padStart(2,"0")}-05`},{departure_date:`${_}-${String(D).padStart(2,"0")}-12`,return_date:`${_}-${String(D).padStart(2,"0")}-12`},{departure_date:`${_}-${String(D).padStart(2,"0")}-18`,return_date:`${_}-${String(D).padStart(2,"0")}-18`}],totalTrips:3},{driverId:"sample-2",driverName:"Mary Wanjiku (Sample)",trips:[{departure_date:`${_}-${String(D).padStart(2,"0")}-03`,return_date:`${_}-${String(D).padStart(2,"0")}-03`},{departure_date:`${_}-${String(D).padStart(2,"0")}-15`,return_date:`${_}-${String(D).padStart(2,"0")}-15`}],totalTrips:2}];if("all"===n)return e;{const s=e.find(e=>e.driverId===n);if(s)return[s];{const s={...e[0]},a=y.find(e=>e.id===n);return a&&(s.driverName=`${a.name} (Sample)`,s.driverId=n),[s]}}})():v,T=v.length>0?v:S;return e.jsxs(p,{className:"bg-white shadow-xl border border-gray-200 mt-6",children:[e.jsxs(N,{className:"bg-gradient-to-r from-green-600 to-blue-600 text-white",children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-6 w-6"}),"Monthly Trip Management Report"]}),e.jsx("p",{className:"text-white/90 text-sm mt-1",children:"Driver trip analysis with weekly breakdown and daily tracking"})]}),e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"month-select",children:"Select Month"}),e.jsx(h,{id:"month-select",type:"month",value:a,onChange:e=>i(e.target.value),className:"w-40"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"driver-select",children:"Select Driver"}),e.jsxs(F,{value:n,onValueChange:m,children:[e.jsx(M,{className:"w-48",children:e.jsx(I,{})}),e.jsxs(L,{children:[e.jsx(P,{value:"all",children:"All Drivers"}),y.map(s=>e.jsx(P,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[e.jsxs("p",{className:"text-sm text-yellow-700",children:[e.jsx("strong",{children:"Debug Info:"})," Work Tickets: ",s.length,", Drivers: ",y.length,", Filtered Trips: ",v.length,", Selected Month: ",a,", Selected Driver: ","all"===n?"All Drivers":y.find(e=>e.id===n)?.name||n,0===v.length&&" (Showing Sample Data)"]}),T.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-yellow-600",children:[e.jsx("strong",{children:"Trip Dates Found:"})," ",T.map(e=>`${e.driverName}: [${e.trips.map(e=>e.departure_date).join(", ")}]`).join(" | ")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Active Drivers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:T.length})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Total Trips"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:T.reduce((e,s)=>e+s.totalTrips,0)})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700 font-medium",children:"Avg Trips/Driver"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:T.length>0?Math.round(T.reduce((e,s)=>e+s.totalTrips,0)/T.length*10)/10:0})]})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse bg-white rounded-lg overflow-hidden shadow-sm",children:[e.jsxs("thead",{children:[e.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:[e.jsx("th",{className:"border border-gray-200 px-4 py-3 text-left font-semibold text-gray-900",children:"Driver Name"}),e.jsx("th",{className:"border border-gray-200 px-4 py-3 text-center font-semibold text-gray-900",children:"Total Trips"}),b.map((s,a)=>e.jsxs("th",{className:"border border-gray-200 px-2 py-3 text-center font-semibold text-gray-900",children:[e.jsxs("div",{className:"text-xs",children:["Week ",a+1]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[s.weekStart.getDate(),"-",s.weekEnd.getDate()]})]},a))]}),e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-200 px-4 py-2"}),e.jsx("th",{className:"border border-gray-200 px-4 py-2"}),b.map((s,a)=>e.jsx("th",{className:"border border-gray-200 px-1 py-2",children:e.jsx("div",{className:"grid grid-cols-7 gap-1 text-xs",children:s.days.map((s,a)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium "+(s.isInCurrentMonth?"text-gray-700":"text-gray-300"),children:s.name}),e.jsx("div",{className:"text-xs mt-1 "+(s.isInCurrentMonth?"text-gray-600":"text-gray-300"),children:s.dayOfMonth})]},a))})},a))]})]}),e.jsx("tbody",{children:T.map((s,a)=>e.jsxs("tr",{className:a%2==0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"border border-gray-200 px-4 py-3 font-medium text-gray-900",children:s.driverName||`Driver ${a+1}`}),e.jsx("td",{className:"border border-gray-200 px-4 py-3 text-center",children:e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-semibold",children:s.totalTrips})}),b.map((a,t)=>e.jsx("td",{className:"border border-gray-200 px-1 py-3",children:e.jsx("div",{className:"grid grid-cols-7 gap-1",children:a.days.map((a,t)=>e.jsx("div",{className:"flex justify-center items-center h-6",children:a.isInCurrentMonth&&j(s,a.date)?e.jsx(c,{className:"h-4 w-4 text-green-600"}):a.isInCurrentMonth?e.jsx("div",{className:"w-4 h-4"}):e.jsx("div",{className:"w-4 h-4 opacity-30"})},t))})},t))]},s.driverId||`sample-${a}`))})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Trip Day"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"No Trip"})]})]})]})]})]})});function W({onTicketStatusChange:s}={}){return e.jsx(G,{onTicketStatusChange:s})}export{W as WorkTicketManagement};
