import{j as e}from"./ui-f76141b1.js";import{r as s}from"./vendor-05a0620d.js";import{C as a,c as l,d as t,e as i,B as r,b as n,p as c,L as d,I as o,T as m,f as h,g as x,h as p,i as j}from"./index-ee0b0cae.js";import{T as u,D as g,a as v,b as N,c as y,d as f}from"./textarea-00ba843c.js";import{S as b,a as w,b as C,c as M,d as S}from"./select-f3c8a2c6.js";import{i as k,g as D,f as I,a as T,b as F,c as $}from"./helpers-a9df5ae9.js";import{C as E,B as q,k as A,h as P,s as V,P as B}from"./icons-4074e4e4.js";import{C as O,T as z,a as W}from"./constants-92d367f8.js";function R({component:s,vehicle:c,onEdit:d}){const o="tire"===s.componentType?E:q,m=(()=>{if(!s.warrantyMonths)return null;const e=new Date(s.installationDate),a=new Date(e);return a.setMonth(a.getMonth()+s.warrantyMonths),a})(),h=m&&new Date<=m,x=m&&k(m.toISOString(),30);return e.jsxs(a,{className:"hover:shadow-md transition-shadow",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(o,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs(t,{className:"text-lg",children:[s.make," ",s.model]}),e.jsx("p",{className:"text-sm text-gray-600",children:c?`${c.gkNumber} - ${c.make} ${c.model}`:s.vehicleId})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:`${D(s.status)} text-white`,children:s.status}),h&&!x&&e.jsx(i,{className:"bg-green-500 text-white",children:"Under Warranty"}),x&&e.jsx(i,{className:"bg-orange-500 text-white",children:"Warranty Expiring Soon"}),d&&e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>d(s),children:e.jsx(A,{className:"h-4 w-4"})})]})]})}),e.jsxs(n,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Serial Number"}),e.jsx("p",{className:"font-medium",children:s.serialNumber})]}),s.position&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Position"}),e.jsx("p",{className:"font-medium capitalize",children:s.position.replace("-"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Installation Date"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),I(s.installationDate)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Installation Mileage"}),e.jsxs("p",{className:"font-medium",children:[T(s.installationMileage)," km"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Purchase Cost"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),F(s.purchaseCost)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Supplier"}),e.jsx("p",{className:"font-medium",children:s.supplier})]})]}),s.removalDate&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 mb-1",children:"Removal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Removal Date"}),e.jsx("p",{className:"text-sm",children:I(s.removalDate)})]}),s.removalMileage&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Removal Mileage"}),e.jsxs("p",{className:"text-sm",children:[T(s.removalMileage)," km"]})]})]})]}),m&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"Warranty Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Warranty Period"}),e.jsxs("p",{className:"text-sm",children:[s.warrantyMonths," months"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Expires"}),e.jsx("p",{className:"text-sm",children:I(m.toISOString())})]})]}),x&&e.jsxs("p",{className:"text-xs text-orange-600 mt-2",children:["Expires in ",$(m.toISOString())," days"]})]}),s.notes&&e.jsxs("div",{className:"mt-4 pt-3 border-t",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Notes"}),e.jsx("p",{className:"text-sm",children:s.notes})]})]})]})}const U=`https://${j}.supabase.co/functions/v1/make-server-3fe6e872`;function J(){const[l,t]=s.useState([]),[i,j]=s.useState([]),[k,D]=s.useState(!1),[I,T]=s.useState("all"),[F,$]=s.useState({vehicleId:"",componentType:"tire",make:"",model:"",serialNumber:"",position:"",installationDate:"",installationMileage:0,removalDate:"",removalMileage:0,status:"active",warrantyMonths:0,purchaseCost:0,supplier:"",notes:""});s.useEffect(()=>{A(),P()},[]);const A=async()=>{try{const e=await fetch(`${U}/components`,{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();t(s.components||[])}}catch(e){console.error("Error fetching components:",e)}},P=async()=>{try{const e=await fetch(`${U}/vehicles`,{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();j(s.vehicles||[])}}catch(e){console.error("Error fetching vehicles:",e)}},V=()=>{$({vehicleId:"",componentType:"tire",make:"",model:"",serialNumber:"",position:"",installationDate:"",installationMileage:0,removalDate:"",removalMileage:0,status:"active",warrantyMonths:0,purchaseCost:0,supplier:"",notes:""})},J=e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch(`${U}/components`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify(F)})).ok&&(D(!1),V(),A())}catch(s){console.error("Error creating component:",s)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"vehicleId",children:"Vehicle*"}),e.jsxs(b,{value:F.vehicleId,onValueChange:e=>$({...F,vehicleId:e}),children:[e.jsx(w,{children:e.jsx(C,{placeholder:"Select a vehicle"})}),e.jsx(M,{children:i.map(s=>e.jsxs(S,{value:s.id,children:[s.gkNumber," - ",s.make," ",s.model]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"componentType",children:"Component Type*"}),e.jsxs(b,{value:F.componentType,onValueChange:e=>$({...F,componentType:e}),children:[e.jsx(w,{children:e.jsx(C,{})}),e.jsx(M,{children:O.map(s=>e.jsx(S,{value:s.value,children:s.label},s.value))})]})]}),"tire"===F.componentType&&e.jsxs("div",{children:[e.jsx(d,{htmlFor:"position",children:"Position*"}),e.jsxs(b,{value:F.position,onValueChange:e=>$({...F,position:e}),children:[e.jsx(w,{children:e.jsx(C,{placeholder:"Select position"})}),e.jsx(M,{children:z.map(s=>e.jsx(S,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"make",children:"Make*"}),e.jsx(o,{id:"make",value:F.make,onChange:e=>$({...F,make:e.target.value}),placeholder:"Michelin, Exide, etc.",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"model",children:"Model*"}),e.jsx(o,{id:"model",value:F.model,onChange:e=>$({...F,model:e.target.value}),placeholder:"Model/Part number",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"serialNumber",children:"Serial Number*"}),e.jsx(o,{id:"serialNumber",value:F.serialNumber,onChange:e=>$({...F,serialNumber:e.target.value}),placeholder:"Unique identifier",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"installationDate",children:"Installation Date*"}),e.jsx(o,{id:"installationDate",type:"date",value:F.installationDate,onChange:e=>$({...F,installationDate:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"installationMileage",children:"Installation Mileage (km)*"}),e.jsx(o,{id:"installationMileage",type:"number",value:F.installationMileage,onChange:e=>$({...F,installationMileage:parseInt(e.target.value)||0}),placeholder:"45000",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"status",children:"Status*"}),e.jsxs(b,{value:F.status,onValueChange:e=>$({...F,status:e}),children:[e.jsx(w,{children:e.jsx(C,{})}),e.jsx(M,{children:W.map(s=>e.jsx(S,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"warrantyMonths",children:"Warranty (months)"}),e.jsx(o,{id:"warrantyMonths",type:"number",value:F.warrantyMonths,onChange:e=>$({...F,warrantyMonths:parseInt(e.target.value)||0}),placeholder:"12"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"purchaseCost",children:"Purchase Cost (KES)*"}),e.jsx(o,{id:"purchaseCost",type:"number",step:"0.01",value:F.purchaseCost,onChange:e=>$({...F,purchaseCost:parseFloat(e.target.value)||0}),placeholder:"25000.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"supplier",children:"Supplier*"}),e.jsx(o,{id:"supplier",value:F.supplier,onChange:e=>$({...F,supplier:e.target.value}),placeholder:"Supplier name",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"notes",children:"Notes"}),e.jsx(u,{id:"notes",value:F.notes,onChange:e=>$({...F,notes:e.target.value}),placeholder:"Additional information..."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>{D(!1),V()},children:"Cancel"}),e.jsx(r,{type:"submit",children:"Add Component"})]})]}),K=s=>{const t=(e=>{let s=l.filter(s=>s.componentType===e);return"all"!==I&&(s=s.filter(e=>e.vehicleId===I)),s.sort((e,s)=>new Date(s.installationDate).getTime()-new Date(e.installationDate).getTime())})(s),r="tire"===s?E:q;return e.jsx("div",{className:"space-y-4",children:0===t.length?e.jsx(a,{children:e.jsxs(n,{className:"py-8 text-center",children:[e.jsx(r,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsxs("p",{className:"text-gray-600",children:["No ",s," records found."]})]})}):t.map(s=>{return e.jsx(R,{component:s,vehicle:(a=s.vehicleId,i.find(e=>e.id===a))},s.id);var a})})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Component Management"}),e.jsxs(g,{open:k,onOpenChange:D,children:[e.jsx(v,{asChild:!0,children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Add Component"]})}),e.jsxs(N,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(y,{children:e.jsx(f,{children:"Add New Component"})}),J]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs(b,{value:I,onValueChange:T,children:[e.jsx(w,{className:"w-64",children:e.jsx(C,{})}),e.jsxs(M,{children:[e.jsx(S,{value:"all",children:"All Vehicles"}),i.map(s=>e.jsxs(S,{value:s.id,children:[s.gkNumber," - ",s.make," ",s.model]},s.id))]})]})}),e.jsxs(m,{defaultValue:"tires",className:"w-full",children:[e.jsxs(h,{className:"grid w-full grid-cols-2",children:[e.jsxs(x,{value:"tires",className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Tires"]}),e.jsxs(x,{value:"batteries",className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Batteries"]})]}),e.jsx(p,{value:"tires",className:"mt-6",children:K("tire")}),e.jsx(p,{value:"batteries",className:"mt-6",children:K("battery")})]})]})}export{J as ComponentManagement};
