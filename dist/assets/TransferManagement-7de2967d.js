import{j as e}from"./ui-f76141b1.js";import{r as s}from"./vendor-05a0620d.js";import{p as a,L as r,I as t,B as i,C as l,b as n,c,d as o,e as d,i as m}from"./index-ee0b0cae.js";import{T as h,D as x,a as j,b as p,c as f,d as u}from"./textarea-00ba843c.js";import{S as g,a as v,b as N,c as y,d as D}from"./select-f3c8a2c6.js";import{f as b,a as B}from"./helpers-a9df5ae9.js";import{P as w,A as C,t as T,h as L}from"./icons-4074e4e4.js";const F=`https://${m}.supabase.co/functions/v1/make-server-3fe6e872`;function k(){const[m,k]=s.useState([]),[z,S]=s.useState([]),[q,I]=s.useState(!1),[$,R]=s.useState("all"),[A,O]=s.useState({vehicleId:"",fromDepartment:"",toDepartment:"",fromLocation:"",toLocation:"",transferDate:"",mileage:0,authorizedBy:"",receivedBy:"",reason:"",notes:""});s.useEffect(()=>{V(),E()},[]);const V=async()=>{try{const e=await fetch(`${F}/transfers`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();k(s.transfers||[])}}catch(e){console.error("Error fetching transfers:",e)}},E=async()=>{try{const e=await fetch(`${F}/vehicles`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();S(s.vehicles||[])}}catch(e){console.error("Error fetching vehicles:",e)}},M=()=>{O({vehicleId:"",fromDepartment:"",toDepartment:"",fromLocation:"",toLocation:"",transferDate:"",mileage:0,authorizedBy:"",receivedBy:"",reason:"",notes:""})},J=()=>{let e=m;return"all"!==$&&(e=e.filter(e=>e.vehicleId===$)),e.sort((e,s)=>new Date(s.transferDate).getTime()-new Date(e.transferDate).getTime())},P=e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{(await fetch(`${F}/transfers`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(A)})).ok&&(I(!1),M(),V())}catch(s){console.error("Error creating transfer:",s)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"vehicleId",children:"Vehicle*"}),e.jsxs(g,{value:A.vehicleId,onValueChange:e=>O({...A,vehicleId:e}),children:[e.jsx(v,{children:e.jsx(N,{placeholder:"Select a vehicle"})}),e.jsx(y,{children:z.map(s=>e.jsxs(D,{value:s.id,children:[s.gkNumber," - ",s.make," ",s.model]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"fromDepartment",children:"From Department*"}),e.jsx(t,{id:"fromDepartment",value:A.fromDepartment,onChange:e=>O({...A,fromDepartment:e.target.value}),placeholder:"State Department for Energy",required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"toDepartment",children:"To Department*"}),e.jsx(t,{id:"toDepartment",value:A.toDepartment,onChange:e=>O({...A,toDepartment:e.target.value}),placeholder:"Regional Office",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"fromLocation",children:"From Location*"}),e.jsx(t,{id:"fromLocation",value:A.fromLocation,onChange:e=>O({...A,fromLocation:e.target.value}),placeholder:"Nairobi HQ",required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"toLocation",children:"To Location*"}),e.jsx(t,{id:"toLocation",value:A.toLocation,onChange:e=>O({...A,toLocation:e.target.value}),placeholder:"Mombasa Office",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"transferDate",children:"Transfer Date*"}),e.jsx(t,{id:"transferDate",type:"date",value:A.transferDate,onChange:e=>O({...A,transferDate:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"mileage",children:"Mileage at Transfer (km)*"}),e.jsx(t,{id:"mileage",type:"number",value:A.mileage,onChange:e=>O({...A,mileage:parseInt(e.target.value)||0}),placeholder:"45000",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"authorizedBy",children:"Authorized By*"}),e.jsx(t,{id:"authorizedBy",value:A.authorizedBy,onChange:e=>O({...A,authorizedBy:e.target.value}),placeholder:"John Doe - Director",required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"receivedBy",children:"Received By*"}),e.jsx(t,{id:"receivedBy",value:A.receivedBy,onChange:e=>O({...A,receivedBy:e.target.value}),placeholder:"Jane Smith - Regional Manager",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"reason",children:"Reason for Transfer*"}),e.jsx(t,{id:"reason",value:A.reason,onChange:e=>O({...A,reason:e.target.value}),placeholder:"Operational requirements, relocation, etc.",required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"notes",children:"Notes"}),e.jsx(h,{id:"notes",value:A.notes,onChange:e=>O({...A,notes:e.target.value}),placeholder:"Additional transfer details..."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>{I(!1),M()},children:"Cancel"}),e.jsx(i,{type:"submit",children:"Record Transfer"})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Vehicle Transfer Management"}),e.jsxs(x,{open:q,onOpenChange:I,children:[e.jsx(j,{asChild:!0,children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Record Transfer"]})}),e.jsxs(p,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(f,{children:e.jsx(u,{children:"Record Vehicle Transfer"})}),P]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs(g,{value:$,onValueChange:R,children:[e.jsx(v,{className:"w-64",children:e.jsx(N,{})}),e.jsxs(y,{children:[e.jsx(D,{value:"all",children:"All Vehicles"}),z.map(s=>e.jsxs(D,{value:s.id,children:[s.gkNumber," - ",s.make," ",s.model]},s.id))]})]})}),e.jsx("div",{className:"space-y-4",children:0===J().length?e.jsx(l,{children:e.jsxs(n,{className:"py-8 text-center",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"No vehicle transfers found."})]})}):J().map(s=>{const a=(r=s.vehicleId,z.find(e=>e.id===r));var r;return e.jsxs(l,{className:"hover:shadow-md transition-shadow",children:[e.jsx(c,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(C,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx(o,{className:"text-lg",children:a?`${a.gkNumber} - ${a.make} ${a.model}`:s.vehicleId}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.fromDepartment," â†’ ",s.toDepartment]})]})]}),e.jsx(d,{className:"bg-blue-500 text-white",children:"Transfer Complete"})]})}),e.jsxs(n,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"From Location"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),s.fromLocation]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"To Location"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),s.toLocation]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Transfer Date"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),b(s.transferDate)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Mileage"}),e.jsxs("p",{className:"font-medium",children:[B(s.mileage)," km"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Authorized By"}),e.jsx("p",{className:"font-medium",children:s.authorizedBy})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Received By"}),e.jsx("p",{className:"font-medium",children:s.receivedBy})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"Reason for Transfer"}),e.jsx("p",{className:"text-sm text-blue-700",children:s.reason})]}),s.notes&&e.jsxs("div",{className:"mt-4 pt-3 border-t",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Notes"}),e.jsx("p",{className:"text-sm",children:s.notes})]})]})]},s.id)})})]})}export{k as TransferManagement};
